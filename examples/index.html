<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="h1">DynamicForms sandbox
            <div id="spinner" class="spinner-border" role="status" style="display: none;">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <p>DynamicForms sandbox: test fields interactions!</p>
        <p>Tip: open developer tools and keep an eye on console/network tabs.</p>

        <form id='jsonPlaceholder'>
            <p class="mt-4">Dynamic Dropdown</p>
            <div class="row">
                <div class="col-1">
                    <label for="user">Users</label>
                </div>
                <div class="col-5">
                    <select id="user" name='user'>
                        <option value="" selected> </option>
                    </select>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-1">
                    <label for="post">Posts</label>
                </div>
                <div class="col-5">
                    <select id="post" name='post'>
                        <option value="" selected></option>
                    </select>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-1">
                    <label for="comment">Comments</label>
                </div>
                <div class="col-5">
                    <select id="comment" name='comment'>
                        <option value="" selected></option>
                    </select>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-1">
                    <label for="album">Albums</label>
                </div>
                <div class="col-5">
                    <select id="album" name='album'>
                        <option value="" selected></option>
                    </select>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-1">
                    <label for="photo">Photo</label>
                </div>
                <div class="col-5">
                    <select id="photo" name='photo'>
                        <option value="" selected></option>
                    </select>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-1">
                    <label for="todo">Todo</label>
                </div>
                <div class="col-5">
                    <select id="todo" name='todo'>
                        <option value="" selected></option>
                    </select>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-2">
                    <p class="mt-4">Dynamic Checkbox</p>
                    <div class="form-check">
                        <input type="checkbox" id="visibility-checkbox" name="visibility-checkbox"
                            class="form-check-input" checked>
                        <label for="visibility-checkbox" class="form-check-label"> Field Visible </label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="readonly-checkbox" name="readonly-checkbox" class="form-check-input">
                        <label for="readonly-checkbox" class="form-check-label"> Field Readonly </label>
                    </div>
                </div>
                <div class="col-4">
                    <p class="mt-4">Dynamic Input</p>
                    <input type="text" class="form-control" name="checkbox-target-field"
                        placeholder="Visible? Readonly?" />
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-2">
                    <p class="mt-4">Dynamic Radio Button</p>
                    Rows number:
                    <div class="form-check">
                        <input type="radio" id="rows-radio-1" name="rows-radio" value="1" class="form-check-input"
                            checked>
                        <label for="rows-radio-1" class="form-check-label">1 Row</label>
                    </div>
                    <div class="form-check">
                        <input type="radio" id="rows-radio-2" name="rows-radio" value="2" class="form-check-input">
                        <label for="rows-radio-2" class="form-check-label">2 Rows</label>
                    </div>
                    <div class="form-check">
                        <input type="radio" id="rows-radio-3" name="rows-radio" value="3" class="form-check-input">
                        <label for="rows-radio-3" class="form-check-label">3 Rows</label>
                    </div>
                </div>
                <div class="col-4">
                    <p class="mt-4">Dynamic Textarea</p>
                    <textarea class="form-control" name="radio-target-textarea" rows="1"
                        placeholder="How many rows?"></textarea>
                </div>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <!-- Single file build (prod mode) -->
    <!-- <script src = '../dist/dynamicforms.js'></script> -->

    <script type="module" defer>
        import '../src/index.js'; // Original src (dev mode)

        let config = {
            'forms': [{
                'id': 'jsonPlaceholder',
                'debug': true,
                'behavior': {
                    'beforeUpdate': (subjectName) => document.getElementById('spinner').style.display = 'inline-block',
                    'afterUpdate': (subjectName) => document.getElementById('spinner').style.display = 'none'
                },
                'fields': [
                    {
                        'name': 'user',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/users`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.username }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'post',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/posts?userId=${data.user}`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.title }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'comment',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/comments?postId=${data.post}`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.name }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'album',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/albums?userId=${data.user}`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.title }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'photo',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/photos?albumId=${data.album}`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.url }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'todo',
                        'fetch': {
                            'makeUrl': (data) => `https://jsonplaceholder.typicode.com/todos?userId=${data.user}`,
                        },
                        'ext': {
                            'postProcessData': (htmlElement, data) => {
                                return data.map(x => { return { 'value': x.id, 'text': x.title }; }).sort((a, b) => a.text > b.text);
                            }
                        }
                    },
                    {
                        'name': 'visibility-checkbox'
                    },
                    {
                        'name': 'readonly-checkbox'
                    },
                    {
                        'name': 'checkbox-target-field',
                        'behavior': {
                            'updateStatus': (htmlElement, data, subjectName) => {
                                let value = data[subjectName];
                                switch (subjectName) {
                                    case 'visibility-checkbox':
                                        if (value === true) {
                                            htmlElement.style.display = "block";
                                        } else {
                                            htmlElement.style.display = "none";
                                        }
                                        break;
                                    case 'readonly-checkbox':
                                        htmlElement.readOnly = value;
                                        break;
                                }
                            },
                        },
                    },
                    {
                        'name': 'rows-radio'
                    },
                    {
                        'name': 'radio-target-textarea',
                        'behavior': {
                            'updateStatus': (htmlElement, data, subjectName) => {
                                let value = parseInt(data[subjectName]);
                                htmlElement.rows = value;
                            },
                        },
                    }
                ],
                'rules': [
                    {
                        'name': 'user',
                        'update': ['post', 'album', 'todo'],
                    },
                    {
                        'name': 'post',
                        'update': ['comment'],
                        'additionalData': ['user'],
                        'externalData': (data, subjectName) => { return { 'timestamp': new Date() } }
                    },
                    {
                        'name': 'album',
                        'update': ['photo']
                    },
                    {
                        'name': 'visibility-checkbox',
                        'update': ['checkbox-target-field']
                    },
                    {
                        'name': 'readonly-checkbox',
                        'update': ['checkbox-target-field']
                    },
                    {
                        'name': 'rows-radio',
                        'update': ['radio-target-textarea']
                    }
                ],
                'init': [
                    {
                        'name': 'user',
                        'externalData': (data, subjectName) => { return { 'timestamp': new Date() }; }
                    }
                ]
            }]
        };

        // Init
        let start = new Date();
        let forms = dynamicForms.makeMultipleForms(config.forms);
        let end = new Date();
        console.log('Benchmark init time: ', end.getMilliseconds() - start.getMilliseconds());
    </script>
</body>

</html>